apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: stock-alert.rules
  namespace: observation
  labels:
    app: kube-prometheus-stack
    release: prometheus-operator
spec:
  groups:
  - name: rules-stock-alert1
    rules:
    - alert: ApplicationDown
      expr: >-
          100 * (count(up == 0) BY (job, namespace, service) / count(up) BY (job, namespace, service)) > 10
      for: 5m
      labels:
        severity: critical
      annotations:
        message: >-
          {{ $labels.job }}/{{ $labels.service }} targets in {{ $labels.namespace }} namespace are down.
  - name: rules-stock-alert2
    rules:
    - alert: ApplicationError
      expr: >-
          ( count (stock_log_error_total) > 0 ) or ( count (stock_log_severe_total) > 0 )
      for: 1m
      labels:
        severity: critical
      annotations:
        message: >-
          {{ $labels.job }}/{{ $labels.service }} targets in {{ $labels.namespace }} namespace are application error.